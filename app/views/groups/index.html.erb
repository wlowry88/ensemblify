<div class="container">
  <div class="wrapper">
    <div class="page-header">
      <h1>
        Ensembles
        <% if current_user %>
        <button class="btn intelligent_ensemble_toggle">Show Intelligent Matches</button>
        <button class="btn"><%= link_to 'New Ensemble', new_group_path %></button>
        <% end %>
      </h1>
    </div>


    <% if current_user %>

    <div class="intelligent_matches">
      <h4>Intelligent Matches</h4>
      <table class="table table-hover" id="pricing-table">
        <thead class="header">
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Complete</th>
            <th>Location</th>
            <th colspan="3"></th>
          </tr>
        </thead>

        <tbody>
          <% @groups.where(complete: false).where.not(admin_id: current_user.id).each do |group| %>
            <% current_user.interests.each do |interest| %>
              <% if interest.instrumentation == group.instrumentation %>
              <tr>
                <td><%= link_to group.name, group %></td>
                <td><%= group.instrumentation.name %></td>
                <td><%= group.complete ? "complete" : "incomplete" %></td>
                <td class="distance"><%= "#{group.admin.city_state} (#{group.distance_from(current_user).round(2)} miles)" if group.zipcode %></td>
              </tr>
              <% end %>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <% end %>

    <div class="all_ensemble_matches">
      <h4>All Ensembles</h4>
      <%= form_for(Group.new) do |f| %>

        <%= f.label :instrumentation_id %>
        <%= f.collection_select :instrumentation_id, Instrumentation.all, :name, :name, {prompt: ""}, { class: 'chosen-select' }  %>

        <%= f.label :instruments %>
        <%= f.collection_select :instruments, Instrument.all, :name, :name, {prompt: ""}, { class: 'chosen-select' } %>

        <%= f.label :complete %>
        <%= f.collection_select :complete, ["complete", "incomplete"], :to_s, :to_s, {prompt: ""}, { class: 'chosen-select' }  %>

        <%= f.submit "Search", class:"search_button btn" %>
        <button class="clear_fields btn">Clear Fields</button>
      <% end %>

      <table class="table table-hover" id="pricing-table">
        <thead class="header">
          <tr >
            <th>Name</th>
            <th>Type</th>
            <th>Complete</th>
            <th>Location</th>
            <th colspan="3"></th>
          </tr>
        </thead>

        <tbody>
          <% @all_groups.each do |group| %>
            <tr>
              <td><%= link_to group.name, group %></td>
              <td class="group_instrumentation"><%= group.instrumentation.name %></td>
              <td class="group_complete"><%= group.complete ? "complete" : "incomplete" %></td>
              <td class="distance"><%= "#{group.admin.city_state} (#{group.distance_from(current_user).round(2)} miles)" if group.zipcode %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <!-- wrapper end -->
    <br>
</div>